angular
    .module('card-stack-demo', ['gajus.swing', 'ngResource'])
.service('FeedService', ['$http', function ($http) {
    return {
        parseFeed: function (url) {
            return $http.jsonp('//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=50&callback=JSON_CALLBACK&q=' + encodeURIComponent(url));
        }
    };
}]).factory('NytOpinion', ['$resource', function($resource) {
  return $resource('http://api.nytimes.com/svc/topstories/v1/opinion.json?fields=byline,multimedia,photo&api-key=44ca79c2e333d9b1b559fd181988bf0f:12:72037481');
}])
.factory('NytWorld', ['$resource', function($resource) {
  return $resource('http://api.nytimes.com/svc/topstories/v2/world.json?fields=byline,multimedia,photo&api-key=44ca79c2e333d9b1b559fd181988bf0f:12:72037481');
}])
    .controller('card-stack-playground', ['$scope', 'NytOpinion', 'NytWorld', function ($scope, NytOpinion, NytWorld) {
    $scope.cards = [];
    var resp = [];
    $scope.wrongAnswers = [];
    $scope.rightAnswer = false;
    $scope.gameOver = false;
    $scope.score = 0;
    $scope.total = 10;
    $scope.turn = 0;
    NytOpinion.get(function (data) {
        resp = data.results;
        $scope.addCards(resp.length, 'op');
    });
    NytWorld.get(function (data) {
        resp = data.results;
        $scope.addCards(resp.length, 'world');
    });

    $scope.addCards = function (count, type) {
        for (var i = 0; i < 5; i++) {
            //$scope.addCard($scope.cards[i].headline, $scope.cards[i].lead_paragraph); 
            if (resp[i].title && resp[i].abstract) {
                var newCard = {
                    title: resp[i].title,
                    byline: resp[i].byline,
                    lead: resp[i].abstract,
                    type: type,
                    image: resp[i].multimedia[2],
                    url: resp[i].url
                };
                $scope.cards.push(newCard);
            }
        }
        shuffle($scope.cards);
    };

    function shuffle(array) {
        var currentIndex = array.length,
            temporaryValue, randomIndex;

        // While there remain elements to shuffle...
        while (0 !== currentIndex) {

            // Pick a remaining element...
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex -= 1;

            // And swap it with the current element.
            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
        }

        return array;
    }


    $scope.cardDestroyed = function (index) {
        $scope.cards.splice(index, 1);
    };

        $scope.throwout = function (eventObject) {
            console.log('throwout', eventObject);
        };

        $scope.throwoutleft = function (eventObject) {
            console.log('throwoutleft', eventObject);
        };

        $scope.throwoutright = function (eventObject) {
            console.log('throwoutright', eventObject);
        };

        $scope.throwin = function (eventObject) {
            console.log('throwin', eventObject);
        };

        $scope.dragstart = function (eventObject) {
            console.log('dragstart', eventObject);
        };

        $scope.dragmove = function (eventObject) {
            console.log('dragmove', eventObject);
        };

        $scope.dragend = function (eventObject) {
            console.log('dragend', eventObject);
        };
    }]);